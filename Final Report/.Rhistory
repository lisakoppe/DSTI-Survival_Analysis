library(tidyverse)
library(survival)
library(survminer)
lungSCC_raw <- read_csv("../LungCancer.csv",
col_types=cols(Sex='c',
Age='d',
Location='d',
Obst_pn_or_plugging='d',
Necrosis='d',
Underlying_lung='d',
Effusion='d',
LN_ratio='d',
cT='d',
cN='d',
cM='d',
pT='d',
pN='d',
pM='d',
Smoking_state='d',
FEV1_FVC='d',
CEA='d',
op_type='d',
death='d',
meta='d',
OS = "d",
.default = 'c'))
dim(lungSCC_raw)  # Check total patients + columns
# Radiologic features
table(lungSCC_raw$Location, useNA="always")
table(lungSCC_raw$Obst_pn_or_plugging, useNA="always")
table(lungSCC_raw$Necrosis, useNA="always")
table(lungSCC_raw$Underlying_lung, useNA="always")
table(lungSCC_raw$Effusion, useNA="always")
# Clinicopathologic features
table(lungSCC_raw$Sex, useNA="always")
table(lungSCC_raw$Age, useNA="always")
summary(lungSCC_raw$Age)
table(lungSCC_raw$LN_ratio, useNA="always")
summary(lungSCC_raw$LN_ratio)
table(lungSCC_raw$cT, useNA="always")
table(lungSCC_raw$cN, useNA="always")
table(lungSCC_raw$cM, useNA="always")
table(lungSCC_raw$pT, useNA="always")
table(lungSCC_raw$pN, useNA="always")
table(lungSCC_raw$pM, useNA="always")
table(lungSCC_raw$Smoking_state, useNA="always")
table(lungSCC_raw$FEV1_FVC, useNA="always")
summary(lungSCC_raw$FEV1_FVC)
table(lungSCC_raw$CEA)
summary(lungSCC_raw$CEA)
table(lungSCC_raw$op_type, useNA="always")
table(lungSCC_raw$death, useNA="always")
table(lungSCC_raw$meta, useNA="always")
table(lungSCC_raw$OS, useNA="always")
summary(lungSCC_raw$OS)
lungSCC <- mutate(lungSCC_raw,
Location=ifelse(Location==0, "Peripheral","Central"),
Necrosis=ifelse(Necrosis==0, "NoRemark",
ifelse(Necrosis==1, "Necrosis", "Cavitization")),
Underlying_lung=ifelse(Underlying_lung==0, "NoRemark",
ifelse(Underlying_lung==1, "Emphysema", "ILA")),
Effusion=factor(Effusion, levels=c("0", "1"), labels=c("Absent", "Present")),
AG=ifelse((Age<60), "LT60", "OV60"),
AG = factor(AG),
OP = factor(op_type,labels = c("lobectomy","pneumonectomy","segmentectomy","LN biopsy","No OP")),
Smoking_state = factor(Smoking_state,labels = c("unknown","current-smoker","ex- smoker", "non- smoker")),
cT = factor(cT, levels = c("1", "2", "3", "4"), labels = c("cT1", "cT2", "cT3", "cT4")),
cN = factor(cN, levels = c("1", "2", "3", "4"), labels = c("cN0", "cN1", "cN2", "cN3")),
cM = factor(cM, levels = c("1", "3"), labels = c("cM0", "cM1b")),
pT = factor(pT, levels = c("1", "2", "3", "4"), labels = c("pT1", "pT2", "pT3", "pT4")),
pN = factor(pN, levels = c("1", "2", "3", "4"), labels = c("pN0", "pN1", "pN2", "pN3")),
pM = factor(pM, levels = c("1", "3"), labels = c("pM0", "pM1b")))
with(lungSCC, Surv(OS, death))
fit.KM <- survfit(Surv(OS, death) ~ 1, data = lungSCC)
fit.KM
ggsurvplot(fit.KM,
legend.title = "Survival",
xlab = "Months",
ylab = "Survival probability")
survdiff(Surv(OS, death)~pN, data=lungSCC)
library(tidyverse)
library(survival)
library(survminer)
library(asaur)
lungSCC_fullmodel <- coxph(Surv(OS, death) ~ Location + Obst_pn_or_plugging + Necrosis + Underlying_lung + Effusion + Sex + AG + LN_ratio + cT+ cN + cM + pT+ pN+ pM + Smoking_state + FEV1_FVC + CEA + OP + meta, data=lungSCC)
lungSCC_fullmodel <- coxph(Surv(OS, death) ~ Location + Obst_pn_or_plugging + Necrosis + Underlying_lung + Effusion + Sex + AG + LN_ratio + cT+ cN + cM + pT+ pN+ pM + Smoking_state + FEV1_FVC + CEA + OP + meta, data=lungSCC)
summary(lungSCC_fullmodel)
broom::tidy(lungSCC_fullmodel) %>%
write_csv("coefficients_table.csv")
lungSCC_fullmodel <- coxph(Surv(OS, death) ~ Location + Obst_pn_or_plugging + Necrosis + Underlying_lung + Effusion + Sex + AG + LN_ratio + cT+ cN + cM + pT+ pN+ pM + Smoking_state + FEV1_FVC + CEA + OP + meta, data=lungSCC)
summary(lungSCC_fullmodel)
lungSCC <- mutate(lungSCC_raw,
Location=ifelse(Location==0, "Peripheral","Central"),
Necrosis=ifelse(Necrosis==0, "NoRemark",
ifelse(Necrosis==1, "Necrosis", "Cavitation")),
Underlying_lung=ifelse(Underlying_lung==0, "NoRemark",
ifelse(Underlying_lung==1, "Emphysema", "ILA")),
Effusion=factor(Effusion, levels=c("0", "1"), labels=c("Absent", "Present")),
AG=ifelse((Age<60), "LT60", "OV60"),
AG = factor(AG),
OP = factor(op_type,labels = c("lobectomy","pneumonectomy","segmentectomy","LN biopsy","No OP")),
Smoking_state = factor(Smoking_state,labels = c("unknown","current-smoker","ex- smoker", "non- smoker")),
cT = factor(cT, levels = c("1", "2", "3", "4"), labels = c("cT1", "cT2", "cT3", "cT4")),
cN = factor(cN, levels = c("1", "2", "3", "4"), labels = c("cN0", "cN1", "cN2", "cN3")),
cM = factor(cM, levels = c("1", "3"), labels = c("cM0", "cM1b")),
pT = factor(pT, levels = c("1", "2", "3", "4"), labels = c("pT1", "pT2", "pT3", "pT4")),
pN = factor(pN, levels = c("1", "2", "3", "4"), labels = c("pN0", "pN1", "pN2", "pN3")),
pM = factor(pM, levels = c("1", "3"), labels = c("pM0", "pM1b")))
broom::tidy(lungSCC_fullmodel) %>%
write_csv("coefficients_table.csv")
fit_Obst_pn_or_plugging <- coxph(Surv(OS, death) ~ Obst_pn_or_plugging, data=lungSCC)
summary(fit_Obst_pn_or_plugging)
fit_necrosis <- coxph(Surv(OS, death) ~ Necrosis, data=lungSCC)
summary(fit_necrosis)
fit_UndLung <- coxph(Surv(OS, death) ~ Underlying_lung, data=lungSCC)
summary(fit_UndLung)
fit_effusion <- coxph(Surv(OS, death) ~ Effusion, data=lungSCC)
summary(fit_effusion)
fit_UndLung <- coxph(Surv(OS, death) ~ Underlying_lung, data=lungSCC)
summary(fit_UndLung)
fit_UndLung <- coxph(Surv(OS, death) ~ Underlying_lung, data=lungSCC)
summary(fit_UndLung)
fit_op_type <- coxph(Surv(OS, death) ~ op_type, data=lungSCC)
summary(fit_op_type)
fit_op_type <- coxph(Surv(OS, death) ~ OP, data=lungSCC)
summary(fit_op_type)
fit_Sex <- coxph(Surv(OS, death)~Sex, data=lungSCC)
summary(fit_Sex)
fit_Age <- coxph(Surv(OS, death)~AG, data=lungSCC)
summary(fit_Age)
fit_LNratio <- coxph(Surv(OS, death)~LN_ratio, data=lungSCC)
summary(fit_LNratio)
fit_Sex <- coxph(Surv(OS, death) ~ Sex, data=lungSCC)
summary(fit_Sex)
fit_Age <- coxph(Surv(OS, death) ~ AG, data=lungSCC)
summary(fit_Age)
fit_UndLung <- coxph(Surv(OS, death) ~ Underlying_lung, data=lungSCC)
summary(fit_UndLung)
fit_LNratio <- coxph(Surv(OS, death) ~ LN_ratio, data=lungSCC)
summary(fit_LNratio)
fit_cT <- coxph(Surv(OS, death) ~ cT, data=lungSCC)
summary(fit_cT)
fit_cN <- coxph(Surv(OS, death) ~ cN, data=lungSCC)
summary(fit_cN)
fit_cM <- coxph(Surv(OS, death) ~ cM, data=lungSCC)
summary(fit_cM)
fit_pT <- coxph(Surv(OS, death) ~ pT, data=lungSCC)
summary(fit_pT)
fit_pN <- coxph(Surv(OS, death) ~ pN, data=lungSCC)
summary(fit_pN)
fit_pM <- coxph(Surv(OS, death) ~ pM, data=lungSCC)
summary(fit_pM)
fit_Smoking_state <- coxph(Surv(OS, death) ~ Smoking_state, data=lungSCC)
summary(fit_Smoking_state)
fit_FEV1FVC <- coxph(Surv(OS, death) ~ FEV1_FVC, data=lungSCC)
summary(fit_FEV1FVC)
fit_CEA <- coxph(Surv(OS, death) ~ CEA, data=lungSCC)
summary(fit_CEA)
fit_op_type <- coxph(Surv(OS, death) ~ OP, data=lungSCC)
summary(fit_op_type)
fit_meta <- coxph(Surv(OS, death) ~ meta, data=lungSCC)
summary(fit_meta)
fit_LNratio <- coxph(Surv(OS, death) ~ LN_ratio, data=lungSCC)
summary(fit_LNratio)
fit_Age <- coxph(Surv(OS, death) ~ AG, data=lungSCC)
summary(fit_Age)
fit_cT <- coxph(Surv(OS, death) ~ cT, data=lungSCC)
summary(fit_cT)
fit_cN <- coxph(Surv(OS, death) ~ cN, data=lungSCC)
summary(fit_cN)
fit_cM <- coxph(Surv(OS, death) ~ cM, data=lungSCC)
summary(fit_cM)
fit_pT <- coxph(Surv(OS, death) ~ pT, data=lungSCC)
summary(fit_pT)
fit_pT <- coxph(Surv(OS, death) ~ pT, data=lungSCC)
summary(fit_pT)
fit_pN <- coxph(Surv(OS, death) ~ pN, data=lungSCC)
summary(fit_pN)
fit_pM <- coxph(Surv(OS, death) ~ pM, data=lungSCC)
summary(fit_pM)
fit_op_type <- coxph(Surv(OS, death) ~ OP, data=lungSCC)
summary(fit_op_type)
fit_meta <- coxph(Surv(OS, death) ~ meta, data=lungSCC)
summary(fit_meta)
